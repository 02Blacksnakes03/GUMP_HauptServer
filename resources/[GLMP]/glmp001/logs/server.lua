

--- DISCORD LOGS ---
webhooks = {
    ["admin"] = "https://discord.com/api/webhooks/952155916273344572/RMuWYZg2UJ7ZRZnopXPmeFLe-hVxC5lC64RLMSg5_qF3ANZd9mPjCKLOob8Bib5g1I9m", --Abuselogs
    ["support"] = "https://discord.com/api/webhooks/944196601914728519/f2K7sqqaOmaUBEjS1jStLMR36aBXF7telxxMfM7Yla4NJti4F_PICn5AEWwto0RFTCUu", --Chat
    ["dmv"] = "https://discord.com/api/webhooks/915959793439637525/HfuYOs5wmCTbh-sSMUaELBO33qylPYoqQs1DJr1nOrCEaKtIckhYPxWMyf0Hw6RMtX1O", --DMVlogs
    ["fraktion"] = "https://discord.com/api/webhooks/915959860498149376/pfohz1vzMAoT7l1mPXK37sAHqCpZ3UEdlsKyuZOPWy3IXBBwqXEvPRZg2kAQpNF2Kdqs", --Fraktionlogs
    ["tankstelle"] = "https://discord.com/api/webhooks/915960014785613946/yiCIAR8Jcd1probF1_gxPGnRf-Q6dZEOMstYaxu8v9JyE5VtxCxHr3qRf_uL7usak6wD", --Tanke
    ["tankstelle_dev"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Logs
    ["dispatch"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Dispatchlogs
    ["lifeinvader"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Logs
    ["noclip"] = "https://discord.com/api/webhooks/952155916273344572/RMuWYZg2UJ7ZRZnopXPmeFLe-hVxC5lC64RLMSg5_qF3ANZd9mPjCKLOob8Bib5g1I9m", --Abuselogs
    ["support_admin"] = "https://discord.com/api/webhooks/952155916273344572/RMuWYZg2UJ7ZRZnopXPmeFLe-hVxC5lC64RLMSg5_qF3ANZd9mPjCKLOob8Bib5g1I9m", --Chat
    ["taxi"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Fraktionlogs
    ["parkkralle"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Logs
    ["staatsdienst"] = "https://discord.com/api/webhooks/952159360614813716/wEPJXeCWWfpBjI_lCXhpkTp4R2-JURGIJZm_Q-_ZX3TPOYQ9UMECWAJjZT-JJezMjWJd", --Fraktion
    ["atm"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Cashlogs
    ["rasen_verkauf"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd", --Logs
    ["einreise"] = "https://discord.com/api/webhooks/952159693801922581/ja0zhfCLJlMrLlCH7ihMfpNOnenEx8qWfH2YDoz5W6DgIbxp_cg58apJHQHk2tpgi17Y", --Einreiselogs
    ["report"] = "https://discord.com/api/webhooks/944196601914728519/f2K7sqqaOmaUBEjS1jStLMR36aBXF7telxxMfM7Yla4NJti4F_PICn5AEWwto0RFTCUu", --chat
    ["garage"] = "https://discord.com/api/webhooks/952159584649363497/Q6xkvtCD7ORwgz7n4k7CW730pbvhaA8vqxAIba0ykLxxIkBLjOLS2F1dRMZRDWKusqiB", --Garage
    ["security"] = "https://discord.com/api/webhooks/952159360614813716/wEPJXeCWWfpBjI_lCXhpkTp4R2-JURGIJZm_Q-_ZX3TPOYQ9UMECWAJjZT-JJezMjWJd", --Frak
    ["death"] = "https://discord.com/api/webhooks/952159281191456770/Io-bfw2TazkZszjmV1k6Ph9rK_Aa1YCECRb6S3ysGEewgQcUwvCzOCm_pqh-ffBSESpO", --Deathlogs
    ["loaded"] = "https://discord.com/api/webhooks/952159210521632788/7maA8L1sl79h_r-kqB6MPTec8IN6u7dsCMui4ppZab4Wiv2cqM27h6XZSEL6KsYXuoVV", --Waffenlogs
    ["givecash"] = "https://discord.com/api/webhooks/952159126266462248/pZu_cjCT5M_ncgNIstgBC6hmw15zc8vSTq4hRWyrzog-RroK-_oHkesSVz7OzmuZ-Cv0", --Cashlogs
    ["inv"] = "https://discord.com/api/webhooks/952158985639845938/otZz1UhK0sct1UzKp1LFaC0mI6B8lMQEw4QLHiq3UyjmCLMoiIHZ0QNBEDQdOR89BvlX", --Inventarlogs
    ["giveitem"] = "https://discord.com/api/webhooks/952158916836470804/kyQGADOMlumRlLHHKeeu4GvpyR6sPL06sNrGTVNKz7TWc5jvqTT39p3QEQuV9pycGUGQ", --Itemlogs
    ["trunk"] = "https://discord.com/api/webhooks/952158824016527371/ykxKt9GpcxOpZaRvybFR8Dg6rPbs-2pldsa3tlH06XHonk6mn6m4RzHCcr3cA8q8cA5V", --KofferraumLogs
    ["quit"] = "https://discord.com/api/webhooks/944196388655337502/uDb1rpzbn1uNH_JJtoedh5EIhoHbLgGGFsaxJPLOBE32_SuSHPHpkUqM149atq1GUMJd" --logs
} 
function sendLog(log, title, message)
	local embed = {
		  {
			  ["color"] = '15158332',
			  ["title"] = "**".. title .."**",
			  ["description"] = message,
			  ["footer"] = {
				  ["text"] = 'Extended Log System | '.. scriptVersion ..' by Blacksnakes ',
			  },
		  } 
	  }  
	PerformHttpRequest(webhooks[log], function(err, text, headers) end, 'POST', json.encode({username = 'Blck-Log-Systems', avatar_url = 'https://cdn.discordapp.com/icons/757652520167407777/56216235da03d7fe4b503e750f9991a0.webp?size=128' , embeds = embed}), { ['Content-Type'] = 'application/json' })
end
 

RegisterServerEvent('byte:sendLog')
AddEventHandler('byte:sendLog', function(log, title, message)
    sendLog(log, title, message)
end)


 
--- LOG

RegisterServerEvent('esx:onPlayerDeath')
AddEventHandler('esx:onPlayerDeath', function(data)
    ----print(json.encode(data))
    data.victim = source
 
    if data.killedByPlayer then
        TriggerEvent('byte:sendLog', 'death', GetPlayerName(data.victim) .. ' ('.. data.victim ..') by ' .. GetPlayerName(data.killerServerId) .. ' ('.. data.killerServerId ..')',"**Time:** ".. os.date('%d.%m.%Y um %H:%M Uhr', os.time()) .. "\n**Distanz vom Killer:** ".. data.distance .. 'Meter\n\n**Identifiers vom Killer:**```' .. json.encode(GetPlayerIdentifiers(data.killerServerId)).. '\n\n```**Identifiers vom Player:**```'.. json.encode(GetPlayerIdentifiers(data.victim)).. '```')
    else
        TriggerEvent('byte:sendLog', 'death', GetPlayerName(data.victim) .. ' ('.. data.victim ..') died')  
    end
end)   
 

i = {}
discordId = {} 
AddEventHandler("playerConnecting", function(name, setReason, deferrals) 
    deferrals.defer()
    local src = source
    local inv
    accounts = nil
    for k,v in pairs(GetPlayerIdentifiers(source))do
        ------print(v)
            
        
        if string.sub(v, 1, string.len("discord:")) == "discord:" then
            discordId[src] = v:gsub("discord:",  "") 
        end
        if string.sub(v, 1, string.len("license:")) == "license:" then
            i[src] = v:gsub("license:", "")
            accounts = MySQL.Sync.fetchScalar("SELECT accounts FROM users WHERE identifier = @identifier", { ['@identifier'] = i[src]})
            admin = MySQL.Sync.fetchScalar("SELECT adminRank FROM users WHERE identifier = @identifier", { ['@identifier'] = i[src]})
            inv = MySQL.Sync.fetchScalar("SELECT inventory FROM users WHERE identifier = @identifier", { ['@identifier'] = i[src]})
            if accounts == nil then 
                accounts = "Nicht Gefunden!"
                admin = "Nicht Gefunden!"
                inv = "Nicht Gefunden!"
            end
        end
         
      
    end  
    TriggerEvent('byte:sendLog', 'loaded', GetPlayerName(src) .. '('.. src ..') verbindet', '**Admin:** '.. admin ..'\n\n**Identifiers:**```'.. json.encode(GetPlayerIdentifiers(src)).. '```\n\n**Accounts:**```'.. accounts ..'```\n\n**Inventar:**```'.. inv ..'```')
    deferrals.done() 
end)

AddEventHandler('playerDropped', function (reason)
    local src = source
    TriggerEvent('byte:sendLog', 'quit', GetPlayerName(src) .. ' hat das Spiel verlassen!', 'Grund: '.. reason ..'\n\n**Identifiers:**```'.. json.encode(GetPlayerIdentifiers(source)).. '```')
end)
 